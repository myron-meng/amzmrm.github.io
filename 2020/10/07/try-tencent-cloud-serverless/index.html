<!DOCTYPE html><html lang="zh-CN"><head><title>Go 使用腾讯云 Serverless-Framework 开发 API</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
}</script><div><div class="inner"><h2>Go 使用腾讯云 Serverless-Framework 开发 API</h2><p>首先，按照<a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1154/42990">说明</a>，安装 Serverless Framework，我是通过 npm 去安装：</p>
<pre><code class="shell">npm install -g serverless</code></pre>
<a id="more"></a>

<p>然后新建一个 Go project 并新建一下文件：</p>
<pre><code class="shell">tryserverless
├── go.mod
├── go.sum
├── main.go
└── serverless.yml</code></pre>
<p>main.go:</p>
<pre><code class="Go">package main

import (
    &quot;context&quot;
    &quot;fmt&quot;
    &quot;github.com/tencentyun/scf-go-lib/cloudfunction&quot;
)

type DefineEvent struct &#123;
    Key1 string `json:&quot;key1&quot;`
    Key2 string `json:&quot;key2&quot;`
&#125;

func Hello(ctx context.Context, event DefineEvent) (string, error) &#123;
    fmt.Println(&quot;key1:&quot;, event.Key1)
    fmt.Println(&quot;key2:&quot;, event.Key2)
    return fmt.Sprintf(&quot;Hello %s!&quot;, event.Key1), nil
&#125;

func main() &#123;
    cloudfunction.Start(Hello)
&#125;
</code></pre>
<p>serverless.yml:</p>
<pre><code class="yaml">component: scf
name: tryserverless
org: test
app: scfApp
stage: dev

inputs:
  name: tryserverless
  src: .
  runtime: Go1
  region: ap-guangzhou
  handler: tryserverless
  events:
    - apigw:
        name: serverless_api
        parameters:
          protocols:
            - http
            - https
          serviceName:
          description: The service of Serverless Framework
          environment: release
          endpoints:
            - path: /hello
              method: GET
</code></pre>
<p>go.mod:</p>
<pre><code class="go">module github.com/dancemystyle/tryserverless // go mod init github.com/dancemystyle/tryserverless, 将github.com/dancemystyle/tryserverless替换为你自己的

go 1.14

require github.com/tencentyun/scf-go-lib v0.0.0-20200116145541-9a6ea1bf75b8 // indirect</code></pre>
<p>代码准备好了，cd 到项目根目录，然后打包、压缩、部署，一气呵成：</p>
<pre><code class="shell">GOOS=linux GOARCH=amd64 go build -o tryserverless main.go
zip tryserverless.zip tryserverless
serverless deploy</code></pre>
<p>执行 serverless deploy 后使用微信扫码就能上传应用并部署，部署成功后得到提示：</p>
<pre><code class="shell">FunctionName: tryserverless
Description:
Namespace:    default
Runtime:      Go1
Handler:      tryserverless
MemorySize:   128
Triggers:
  apigw:
    - https://************.gz.apigw.tencentcs.com/release/hello


24s › tryserverless › Success</code></pre>
<p>访问 apigw 下的 URL 即可测试你的 Serverless API。</p>
<p>再分享一下我遇到的腾讯云 Serverless 文档不完善/不一致带来的小问题：</p>
<ol>
<li>Go runtime 值不统一。Serverless Framework 的<a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1154/39271">文档</a>说使用 Go 语言的话，serverless.yml 里的 inputs.runtime 填 Golang1，但事实上只有 Go1 才能工作：<br><img src="/images/image-20200526233418375.png"></li>
<li>serverless.yml的 inputs.handler 字段。应该使用打包出来的二进制的名字，对应到上面的例子，就是应该填 tryserverless。</li>
</ol>
</div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '');</script></html>
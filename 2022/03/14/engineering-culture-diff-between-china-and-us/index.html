<!DOCTYPE html><html lang="zh-CN"><head><title>中美 IT 公司间不可思议的工程文化差异</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
}</script><div><div class="inner"><h2>中美 IT 公司间不可思议的工程文化差异</h2><h2 id="文化差异"><a href="#文化差异" class="headerlink" title="文化差异"></a>文化差异</h2><p>你阅读过 InfoQ 的<a target="_blank" rel="noopener" href="https://www.infoq.cn/article/jm0g5zkl3osu8hugibna">【从 TikTok“重 QA 轻测试”来看中美软件开发之间的差异】</a>这篇文章吗？一位曾在 TikTok 工作了一年多的华裔（之前任职于 Snapchat 和 Facebook）在网络上分享自己在 TikTok 工作体验，其中提到了 2 点中美 IT 公司工程文化的巨大差异：</p>
<ol>
<li>中国的工程师不用做单元测试；</li>
<li>中国公司的代码合并无需批准。</li>
</ol>
<p>在美国 IT 公司工作的工程师可能会被这种做法震惊到！</p>
<p>我在一线开发岗位从业多年，亲身了解过在众多中小型 IT 公司的情况，也在面试的时候了解过大公司的情况，我认为这位华裔说的是事实。</p>
<a id="more"></a>

<p>我曾在一家由 Facebook 离职员工创办的公司工作过 1 年，单元测试和 code review 是所有工程师们的工作流中必不可少的一部分，可以说我体验了一次美国 IT 公司的工程文化。在这段工作经历之后，我认为单元测试和 code review 是非常重要的，但遗憾的是很多中国的 IT 公司没有在这样做，至于为什么没有这样做，我认为是一个复杂的话题，此处不做讨论。本文只说说为什么我们需要单元测试和 code review。</p>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>相比没有单元测试的代码，有单元测试的代码具有以下优点：</p>
<ul>
<li>提高代码的正确率和可靠性<strong>；</strong></li>
<li>尽早发现问题。问题越早发现，解决的难度和成本就越低；</li>
<li>提高团队各成员之间的沟通效率。新代码未经过测试就发布到测试环境，可能会带有明显的 bug，这会制造非常多繁琐的协作流程：测试人员发现明显的 bug → 新建缺陷 → 开发人员收到缺陷后开始排查并修复 → 提交代码后再次发布 → 测试人员验证；</li>
<li>保证重构的正确性<strong>。</strong>随着功能的增加，重构（修改老代码）几乎是无法避免的，很多时候我们没有信心做代码重构，就是因为担心重构会导致引入新的 bug。有了单元测试，只要在改完代码后运行一下单元测试就知道改动对整个系统的影响了；</li>
<li>优化代码设计。编写单元测试需要开发人员让自己的代码通过多个测试案例，这会会迫使开发人员仔细思考代码的设计和必须完成的工作，有利于开发人员加深对代码功能的理解，从而形成更合理的设计和结构；</li>
<li>即使你不测试你写的代码，总有人会！QA 团队，甚至产品的最终用户。如果我们珍视自己辛勤开发的产品，就绝无可能（在知情的情况下，或者说不了解质量和产品可靠性的情况下）让用户为我们完成测试工作！</li>
</ul>
<h2 id="Code-Review"><a href="#Code-Review" class="headerlink" title="Code Review"></a>Code Review</h2><p>我并不认为以下这个“代码合并”流程（大多数中国 IT 公司使用的流程）属于真正的 code review：</p>
<ul>
<li>工程师的代码可以推送到远程后即可直接合并到目标分之，无需经过其他成员的仔细 Review、解决提出的 issue 和改进建议、批准。然后定期全员开会对代码做展示、检查。</li>
</ul>
<p>我所体验到的真正的 code review 工作流是这样的：</p>
<ul>
<li>所有的 MR 都应该分配给其他成员（或者所有的 code review 小组）进行 review，其他成员可能会提出 issue 和改进建议，等到把所有的 issue 都解决了，并且得到批准后（Approve），才能合并到目标分支。</li>
<li>如果公司没有专门的 code review 团队，那么团队里所有的工程师都要做 code review 工作，即使是今天才加入的新成员，也要加入到 assignee 列表里！</li>
</ul>
<h3 id="所有-MR-都应该经过团队成员的-review-和批准后才能合并"><a href="#所有-MR-都应该经过团队成员的-review-和批准后才能合并" class="headerlink" title="所有 MR 都应该经过团队成员的 review 和批准后才能合并"></a>所有 MR 都应该经过团队成员的 review 和批准后才能合并</h3><p>因为工程师写的代码极大可能会带有问题，比如对业务理解不足导致实现偏差、逻辑错误、造成 crash、造成任何可能后果的 bug、代码风格不符合项目的规范和惯例等，没有经过团队其他成员 Review 的代码都应该被认为是有问题的、有风险的、可能是有错误的，这些代码从一开始就不应该合并到任何目标分支！既然是错误的代码，我们从一开始就不应该让它们合并到任何目标分支，因为我们不能从一开始就做错误的事情，难道不是吗？如果采用工程师随时可以合并代码然后定期进行 Review 这种方式，那相当于等一个病人病入膏肓了再施以救助。我们得明白，越早发现问题，解决问题的代价就越小！ 通过把 MR assign 给所有的团队成员，让成员审核此 MR 范围内的代码是否有问题，能让整个项目都极大地受益：</p>
<ul>
<li>每次针对单个 MR 范围内有限的改动代码做 Review 能更加高效地发现问题和解决问题，成本是最低的；</li>
<li>开发工作能在整个流程都朝着正确的方向前进，而不是发现走错了再回头修改；</li>
<li>代码风格也符合项目规范和惯例，极大地提高了代码的可读性、可维护性；</li>
<li>出现 bug 的可能性被降到了最低；</li>
<li>极大地提升了质量和可靠性；</li>
</ul>
<p>简而言之就是<strong>从一开始就做正确的事情和走正确的路，而不是走一段路后再回头看看我们是否做错了或者走错路了！</strong></p>
<h3 id="为什么所有团队成员都应该参与-code-review，而不仅限于少数特定工程师"><a href="#为什么所有团队成员都应该参与-code-review，而不仅限于少数特定工程师" class="headerlink" title="为什么所有团队成员都应该参与 code review，而不仅限于少数特定工程师"></a>为什么所有团队成员都应该参与 code review，而不仅限于少数特定工程师</h3><ul>
<li>如果没有专门的 code reveiw 团队，那么所有工程师都应该参与 code review。团队里的所有人都是人，不是神，不管少数特定 code review 的工程师能力多强、资质和级别多高，他们都会疲惫、会被其他事情分心、会有极限，从而他们写的代码也可能出错，他们写的代码也需要有人 review！并且依赖他们有限的投入去找出 MR 所有的 issue 也是不现实的！让团队所有人都参加 code review 完美地解决了这个问题；</li>
<li>如果只有少数特定工程师才能进行 code review 和批准合并，那么他们会被累死。少数特定工程师要做自己负责的工作内容，最后还要再来应付所有团队成员源源不断的 MR，能不被累死吗？</li>
<li>团队成员互相 review 代码，可以让大家都从其他人那里学习到知识，了解其他人是怎么工作的，了解其他人是怎么思考的，毕竟三人行，必有我师焉。这样做所有成员对项目的理解能有一个很大的交集，彼此对项目的认知都在同一页上，都熟悉同一份项目知识文档，这是非常重要的。</li>
</ul>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>最后，你可能发现使用正确的方式做 code review 简直就是不可能，因为我们现在的文化不是这样，阻力可想而知！但是了解真正的 code review 工作流程很重要，当你成立自己的公司时要从零开始搭建你的团队，你有机会决定工程师团队的文化，阻力是最小的。</p>
<p>接下来我会写一篇文章说说我是如何实践单元测试的，敬请期待。</p>
</div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '');</script></html>
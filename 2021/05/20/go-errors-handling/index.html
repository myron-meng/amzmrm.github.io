<!DOCTYPE html><html lang="zh-CN"><head><title>Go Errors Handling</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
}</script><div><div class="inner"><h2>Go Errors Handling</h2><p>å¦‚ä½•æ­£ç¡®è€Œä¼˜é›…åœ°å¤„ç†é”™è¯¯æ˜¯æ¯ä¸ª Go ç¨‹åºå‘˜éƒ½è¦æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ã€‚Go å¤„ç†é”™è¯¯çš„æ–¹å¼ä¸åŒäºä¸»æµè¯­è¨€ï¼Œæ¯”å¦‚ Java ä½¿ç”¨ <code>try ... catch ... finally</code> è¯­å¥å»å¤„ç†ç¨‹åºçš„å¼‚å¸¸/é”™è¯¯ï¼ŒGo ä¸­æ²¡æœ‰è¿™æ ·çš„é”™è¯¯å¤„ç†è¯­å¥ã€‚</p>
<p>Go çš„é”™è¯¯å¤„ç†ä¹Ÿæ˜¯å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„ç”¨æˆ·ä½¿ç”¨ Go è¯­è¨€æ—¶ç»å¸¸è°ˆåˆ°çš„è¯é¢˜ï¼Œå¤§å¤šæ•°äººéƒ½è®¤ä¸º Go çš„é”™è¯¯å¤„ç†æ–¹å¼ä¼šå¯¼è‡´ä»£ç é‡Œæœ‰å¤ªå¤šç¹ççš„ã€é‡å¤çš„ <code>if err â‰  nil &#123;&#125;</code>ã€‚ä½†ç›®å‰ Go å®˜æ–¹å¹¶æ²¡æœ‰æ”¹è¿›é”™è¯¯å¤„ç†æœºåˆ¶çš„è®¡åˆ’ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿåªèƒ½ç»§ç»­ä½¿ç”¨ç›®å‰çš„æ–¹å¼å»å¤„ç†é”™è¯¯ã€‚</p>
<h2 id="é”™è¯¯å¤„ç†ç­–ç•¥"><a href="#é”™è¯¯å¤„ç†ç­–ç•¥" class="headerlink" title="é”™è¯¯å¤„ç†ç­–ç•¥"></a>é”™è¯¯å¤„ç†ç­–ç•¥</h2><p>åœ¨ Go ä¸­ï¼Œé”™è¯¯å¤„ç†æ„å‘³ç€æ£€æŸ¥é”™è¯¯å€¼å¹¶åšå‡ºå†³å®šï¼ŒGo é”™è¯¯å¤„ç†æœºåˆ¶æ˜¯åŸºäºå…¶ä»¥ä¸‹è¯­è¨€ç‰¹æ€§ï¼š</p>
<ol>
<li>Errors are valuesï¼Œå³åœ¨ Go ä¸­é”™è¯¯å°±æ˜¯å€¼ï¼Œå°±åƒ <code>&quot;hello world&quot;</code> ä¹‹äº <code>string</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜é‡å»æ‰¿è½½é”™è¯¯ã€‚Go ç”¨æˆ·å¿…é¡»æ£€æŸ¥å‡½æ•°è¿”å›çš„é”™è¯¯çš„å€¼ï¼Œç»“åˆ <code>if ... else ...</code> æˆ–è€… <code>switch &#123; ... &#125;</code> å»åšæµç¨‹æ§åˆ¶ï¼ˆç»ˆæ­¢ç¨‹åºæ‰§è¡Œæµç¨‹ã€ç»§ç»­æ‰§è¡Œæµç¨‹ï¼‰ï¼›</li>
<li>å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼ï¼Œå¦‚æœå‡½æ•°è¦è¿”å›é”™è¯¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŠŠé”™è¯¯æ”¾åœ¨å¤šä¸ªè¿”å›å€¼ä¸­çš„æœ€åä¸€ä¸ªï¼Œå½¢å¦‚è¿™ä¸ªå‡½æ•°ç­¾åï¼š<code>func func1() (int, int, error)</code>ã€‚</li>
</ol>
<p>ç›®å‰ Go ç”Ÿæ€ä¸­ï¼Œå¸¸è§çš„é”™è¯¯å¤„ç†ç­–ç•¥æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>å“¨å…µé”™è¯¯ï¼ˆSentinel errorsï¼‰</li>
<li>é”™è¯¯ç±»å‹ï¼ˆ Error typesï¼‰</li>
<li>ä¸é€æ˜é”™è¯¯ï¼ˆ Opaque errorsï¼‰</li>
</ol>
<h3 id="å“¨å…µé”™è¯¯"><a href="#å“¨å…µé”™è¯¯" class="headerlink" title="å“¨å…µé”™è¯¯"></a>å“¨å…µé”™è¯¯</h3><p>é¢„å®šä¹‰çš„ã€ç­‰äºå›ºå®šå€¼çš„é”™è¯¯ï¼Œç§°ä¸ºå“¨å…µé”™è¯¯ã€‚å¸¸è§çš„ä¸€ä¸ªå“¨å…µé”™è¯¯ <code>sql.ErrNoRows</code> æ˜¯ï¼š</p>
<pre><code class="go">// ErrNoRows is returned by Scan when QueryRow doesn&#39;t return a
// row. In such a case, QueryRow returns a placeholder *Row value that
// defers this error until a Scan.
var ErrNoRows = errors.New(&quot;sql: no rows in result set&quot;)</code></pre>
<p>gorm ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„ä¸œè¥¿ï¼š</p>
<pre><code class="go">// ErrRecordNotFound record not found error
var ErrRecordNotFound = errors.New(&quot;record not found&quot;)</code></pre>
<p><code>sql.ErrNoRows</code> å’Œ <code>gorm.ErrRecordNotFound</code> çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¡¨ç¤º<strong>æ»¡è¶³ where å­å¥æ¡ä»¶çš„æ•°æ®åº“è®°å½•ä¸å­˜åœ¨</strong>ã€‚</p>
<p>å“¨å…µé”™è¯¯çš„å¤„ç†æ–¹å¼æ˜¯ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>err</code> æ—¶ï¼Œæ‹¿å®ƒè·Ÿç›®æ ‡å“¨å…µé”™è¯¯åš<strong>ç­‰å€¼æ¯”è¾ƒ</strong>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="go">file, err := h.Repositories.File.SelectOne(ctx, fileID)
if err != nil &#123;
  if err == sql.ErrNoRows &#123;
    return FileNotFound(ctx)
  &#125;
  return InternalServerError(ctx, err)
&#125;</code></pre>
<p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œå½“ <code>err == sql.ErrNoRows</code> æˆç«‹æ—¶ï¼Œæˆ‘ä»¬ç»™å®¢æˆ·ç«¯è¿”å› <code>HTTP 404</code>ï¼Œå½“ <code>err == sql.ErrNoRows</code> ä¸æˆç«‹æ—¶ï¼Œæˆ‘ä»¬ç»™å®¢æˆ·ç«¯è¿”å› <code>HTTP 500</code>ï¼ˆå¯èƒ½æ˜¯æ•°æ®åº“æœåŠ¡å™¨å®•æœºäº†ï¼‰ã€‚</p>
<p>å“¨å…µé”™è¯¯çš„å¤„ç†å¾ˆç®€å•ï¼Œä½†å®ƒæœ‰ç¼ºç‚¹ã€‚é¦–å…ˆå®ƒç¼ºå°‘è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå“¨å…µé”™è¯¯åªåŒ…å«ä¸€å¥ç®€çŸ­çš„å­—ç¬¦ä¸²ä¿¡æ¯ã€‚å®ƒçš„å€¼æ˜¯å›ºå®šçš„ï¼Œåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­æ”¹å˜å“¨å…µé”™è¯¯çš„å€¼ï¼Œé‚£å°±æ‰“ç ´äº†ä½ å’Œ API ç”¨æˆ·çš„çº¦å®šï¼ŒAPI ç”¨æˆ·çš„ä»£ç å¯èƒ½å°±è¦å‡ºç°ä¸å…¼å®¹æˆ–è€… bug äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºå°† <code>sql.ErrNoRows</code> æ”¹ä¸º <code>nil</code>ï¼š</p>
<pre><code class="go">sql.ErrNoRows = nil</code></pre>
<p>é‚£å°±å‡ºå¤§é—®é¢˜äº†ï¼</p>
<p>å“¨å…µé”™è¯¯çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯åœ¨ä¸¤ä¸ªåŒ…ä¹‹é—´åˆ›å»ºäº†æºä»£ç ä¾èµ–å…³ç³»ï¼Œå­˜åœ¨ç›´æ¥ä»£ç è°ƒç”¨çš„åŒ…ä¹‹é—´å­˜åœ¨æºä»£ç ä¾èµ–å…³ç³»æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯ä¸å­˜åœ¨ç›´æ¥ä»£ç è°ƒç”¨çš„åŒ…ä¹‹é—´çš„æºä»£ç ä¾èµ–å…³ç³»è¢«è®¤ä¸ºæ˜¯ä¸æ­£å¸¸çš„ã€‚è¿˜æ˜¯ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼š</p>
<pre><code class="go">import (
    &quot;context&quot;
    &quot;database/sql&quot;
  ...
)

...

file, err := h.Repositories.File.SelectOne(ctx, fileID)
if err != nil &#123;
  if err == sql.ErrNoRows &#123;
    return FileNotFound(ctx)
  &#125;
  return InternalServerError(ctx, err)
&#125;</code></pre>
<p>è¿™æ˜¯ controller å±‚çš„ä»£ç ï¼Œç¦» repository å±‚ä¸­é—´éš”äº†ä¸ª service å±‚ã€‚å°½ç®¡ handler å±‚å¹¶æ²¡æœ‰è·Ÿæ•°æ®åº“æ“ä½œæœ‰å…³çš„ä»£ç ï¼Œä½†ä¸ºäº†è¯†åˆ« <code>sql.ErrNoRows</code> å¹¶è¿”å› <code>HTTP 404</code> ç»™å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—å¯¼å…¥ <code>&quot;database/sql&quot;</code> åŒ…ã€‚ä¸ºäº†å¤„ç†å“¨å…µé”™è¯¯ï¼Œä¸¤ä¸ªæ²¡æœ‰å¤šå¤§å…³è”çš„åŒ…ä¹‹é—´äº§ç”Ÿäº†æºä»£ç ä¾èµ–å…³ç³»ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå½“é¡¹ç›®ä¸­çš„è®¸å¤šåŒ…éƒ½å¯¼å‡ºå“¨å…µé”™è¯¯å€¼æ—¶ï¼ŒåŒ…ä¸åŒ…ä¹‹é—´å­˜åœ¨è€¦åˆå…³ç³»å°†å˜å¾—é”™ç»¼å¤æ‚ã€‚</p>
<h3 id="é”™è¯¯ç±»å‹"><a href="#é”™è¯¯ç±»å‹" class="headerlink" title="é”™è¯¯ç±»å‹"></a>é”™è¯¯ç±»å‹</h3><p>é”™è¯¯ç±»å‹æŒ‡æ˜¯å®ç°äº† <code>error</code> æ¥å£çš„è‡ªå®šä¹‰ç±»å‹ï¼ŒGo æ ‡å‡†åº“é‡Œä¸€ä¸ªä¸é”™çš„ä¾‹å­æ˜¯ <code>os.PathError</code>ï¼Œå®ƒæä¾›äº†åº•å±‚æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œã€å“ªä¸ªè·¯å¾„å‡ºäº†é—®é¢˜ã€‚æºç ï¼š</p>
<pre><code class="go">// PathError records an error and the operation and file path that caused it.
type PathError struct &#123;
    Op   string
    Path string
    Err  error
&#125;

func (e *PathError) Error() string &#123; return e.Op + &quot; &quot; + e.Path + &quot;: &quot; + e.Err.Error() &#125;

func (e *PathError) Unwrap() error &#123; return e.Err &#125;</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>*PathError</code> æœ‰ä¸€ä¸ª <code>Error() string</code> æ–¹æ³•ï¼Œè¿™è¡¨ç¤ºå®ƒå®ç°äº† <code>src/builtin/builtin</code> é‡Œçš„ <code>error</code> æ¥å£ï¼š</p>
<pre><code class="go">// The error built-in interface type is the conventional interface for
// representing an error condition, with the nil value representing no error.
type error interface &#123;
    Error() string
&#125;</code></pre>
<p>è¿™ä½¿å¾—åœ¨ä»»ä½•éœ€è¦è¿”å›ä¸€ä¸ª <code>error</code> çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä¸€ä¸ª <code>*PathError</code> ï¼š</p>
<pre><code class="go">// openFileNolog is the Unix implementation of OpenFile.
// Changes here should be reflected in openFdAt, if relevant.
func openFileNolog(name string, flag int, perm FileMode) (*File, error) &#123;

  ...

    var r int
    for &#123;
        var e error
        r, e = syscall.Open(name, flag|syscall.O_CLOEXEC, syscallMode(perm))
        if e == nil &#123;
            break
        &#125;

        // We have to check EINTR here, per issues 11180 and 39237.
        if e == syscall.EINTR &#123;
            continue
        &#125;

        return nil, &amp;PathError&#123;Op: &quot;open&quot;, Path: name, Err: e&#125;
    &#125;

  ...

    return newFile(uintptr(r), name, kindOpenFile), nil
&#125;</code></pre>
<p>è¿™æ˜¯æ ‡å‡†åº“ <code>os.OpenFile</code> å‡½æ•°å†…éƒ¨è°ƒç”¨åˆ°çš„å‡½æ•° <code>openFileNolog</code> ï¼Œå®ƒçš„ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯ <code>error</code> ç±»å‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ç¬¬ 20 è¡Œè¿”å›äº† <code>&amp;PathError&#123;Op: &quot;open&quot;, Path: name, Err: e&#125;</code>ã€‚æ­¤å¤„è¿”å›äº†é”™è¯¯ç±»å‹ <code>*os.PathError</code>ï¼Œæ¯”å“¨å…µé”™è¯¯æºå¸¦äº†æ›´å¤šæœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
<p>è™½ç„¶é”™è¯¯ç±»å‹ä¸ºé”™è¯¯æä¾›è¯¦ç»†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†ä»ç„¶å­˜åœ¨é—®é¢˜ï¼šå¦‚æœè°ƒç”¨è€…è¦ä½¿ç”¨ç±»å‹æ–­è¨€æˆ– <code>type switch</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å°†é”™è¯¯ç±»å‹å˜ä¸º exportedï¼Œå³å¯¼å‡ºçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;os&quot;

    &quot;github.com/pkg/errors&quot;
)

func main() &#123;
    f, err := os.Open(&quot;env/.env&quot;)
    switch e := err.(type) &#123;
    case nil:
        // call succeeded, nothing to do
    case *os.PathError:
        fmt.Printf(&quot;op=%s, path=%s, err=%v&quot;, e.Op, e.Path, e.Error())
    default:
        // unknown error
    &#125;
    _ = f
&#125;</code></pre>
<p>å½“ <code>env/.env</code> ä¸å­˜åœ¨æ—¶ï¼Œä¼šè¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="shell">op=open, path=env/.env, err=open env/.env: no such file or directory</code></pre>
<p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å¾—å¯¼å…¥ <code>os</code> åŒ…ã€‚å¯è§ï¼Œé”™è¯¯ç±»å‹å¹¶æ²¡æœ‰è§£å†³å“¨å…µé”™è¯¯çš„è°ƒç”¨è€…å’Œæºä»£ç å­˜åœ¨å¼ºè€¦åˆå’Œæºä»£ç ä¾èµ–çš„é—®é¢˜ã€‚</p>
<h3 id="ä¸é€æ˜é”™è¯¯"><a href="#ä¸é€æ˜é”™è¯¯" class="headerlink" title="ä¸é€æ˜é”™è¯¯"></a>ä¸é€æ˜é”™è¯¯</h3><p>è¿™æ˜¯æœ€çµæ´»çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œå› ä¸ºå®ƒæ‰€äº§ç”Ÿçš„ä»£ç å’Œè°ƒç”¨è€…ä¹‹é—´çš„è€¦åˆæœ€å°‘ã€‚</p>
<p>è¿™ç§é£æ ¼ç§°ä¸º opaque errors ï¼Œå³ä¸é€æ˜é”™è¯¯ã€‚å› ä¸ºè™½ç„¶ä½ çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ï¼Œä½†ä½ æ— æ³•çœ‹åˆ°é”™è¯¯çš„å†…éƒ¨ï¼Œä½œä¸ºè°ƒç”¨è€…ï¼Œä½ åªçŸ¥é“æ“ä½œçš„ç»“æœåˆ°åº•æ˜¯æˆåŠŸäº†è¿˜æ˜¯å¤±è´¥äº†ã€‚</p>
<p>è¿™å°±æ˜¯ä¸é€æ˜é”™è¯¯çš„å…¨éƒ¨å†…å®¹ï¼Œåªéœ€è¿”å›é”™è¯¯è€Œæ— éœ€å‡è®¾å…¶å†…å®¹ã€‚ å¦‚æœä½ é‡‡ç”¨æ­¤ç­–ç•¥ï¼Œé‚£ä¹ˆé”™è¯¯å¤„ç†ä½œä¸ºè°ƒè¯•è¾…åŠ©å·¥å…·å°†å˜å¾—æ›´åŠ æœ‰ç”¨ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="go">import â€œgithub.com/quux/barâ€

func fn() error &#123;
        x, err := bar.Foo()
        if err != nil &#123;
                return err
        &#125;
        // use x
&#125;</code></pre>
<p>ä¾‹å¦‚ï¼Œ<code>Foo</code> å‡½æ•°ä¸ä¿è¯åœ¨å‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹å®ƒå°†è¿”å›ä»€ä¹ˆã€‚ <code>Foo</code> çš„ä½œè€…ç°åœ¨å¯ä»¥è‡ªç”±åœ°ç»™å®ƒç»æ‰‹çš„é”™è¯¯æ·»åŠ é¢å¤–çš„ä¸Šä¸‹æ–‡æ³¨é‡Šï¼ˆå¯èƒ½æ˜¯å®ƒè‡ªå·±äº§ç”Ÿçš„æ–°é”™è¯¯ï¼Œä¹Ÿå¯èƒ½æ˜¯å®ƒè°ƒç”¨çš„ä»£ç è¿”å›çš„é”™è¯¯ï¼‰ï¼Œè€Œä¸ä¼šç ´åä¸è°ƒç”¨æ–¹çš„çº¦å®šã€‚</p>
<p>ä¸é€æ˜é”™è¯¯çš„å¤„ç†éœ€è¦ä¾èµ– <a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a> åº“ï¼ˆ æˆ–è€…æä¾›äº†ç›¸ä¼¼ API çš„åº“ï¼ŒGo 1.13 ä¹Ÿå¼•è¿›äº† <code>errors </code> åŒ…ï¼‰ï¼Œpkg/errors æœ€ä¸»è¦çš„ API æ˜¯ï¼š</p>
<p><code>Wrap</code> å‡½æ•°ï¼š</p>
<pre><code class="go">type withMessage struct &#123;
    cause error
    msg   string
&#125;

type withStack struct &#123;
    error
    *stack
&#125;

// Wrap è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ç»™è¿”å›çš„é”™è¯¯é™„ä¸Šæ³¨é‡Šä¿¡æ¯ï¼Œæ³¨é‡Šä¿¡æ¯åŒ…æ‹¬ message å’Œåœ¨è°ƒç”¨ Wrap æ—¶çš„ stack traceã€‚
// å¦‚æœ err ä¸º nilï¼ŒWrap è¿”å› nilã€‚
func Wrap(err error, message string) error &#123;
    if err == nil &#123;
        return nil
    &#125;
    err = &amp;withMessage&#123;
        cause: err,
        msg:   message,
    &#125;
    return &amp;withStack&#123;
        err,
        callers(),
    &#125;
&#125;</code></pre>
<p><code>Cause</code> å‡½æ•°ï¼š</p>
<pre><code class="go">// Cause è¿”å› err åŒ…å«çš„åº•å±‚é”™è¯¯ã€‚å¦‚æœ err æœ‰å®ç° causer æ¥å£ï¼Œé‚£ä¹ˆä¼šè¿”å› err çš„åŸå§‹é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› nilã€‚
func Cause(err error) error &#123;
    type causer interface &#123;
        Cause() error
    &#125;

    for err != nil &#123;
        cause, ok := err.(causer)
        if !ok &#123;
            break
        &#125;
        err = cause.Cause()
    &#125;
    return err
&#125;</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a> åº“çš„ <code>Wrap</code> åšçš„äº‹æƒ…å°±æ˜¯ä½¿ç”¨ <code>err + message</code> åŒ…è£…ä¸€ä¸ªå®ç°äº† <code>cause</code> æ¥å£çš„ errï¼Œç„¶åä½¿ç”¨ <code>cause err + stack trace</code> åˆåŒ…è£…æˆä¸€ä¸ªæ–°çš„ errï¼Œç®€å•æ¥è¯´å°±æ˜¯ <code>Wrap</code> åœ¨åš error å¥—å¨ƒï¼å› æ­¤ <code>Cause</code> åšçš„äº‹æƒ…ç›´ç™½æ¥è¯´å°±æ˜¯åå¥—å¨ƒäº†ã€‚æ›´è¯¦ç»†çš„ <code>Wrap</code> å’Œ <code>Cause</code> ä»‹ç»è¯·é˜…è¯» <a href="##%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%BA%93">é”™è¯¯å¤„ç†åº“</a> è¿™ä¸€èŠ‚ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥šï¼Œä¸é€æ˜é”™è¯¯çš„å­˜åœ¨çš„æ„ä¹‰å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³å“¨å…µé”™è¯¯æˆ–è€…é”™è¯¯ç±»å‹çš„ç¼ºç‚¹ï¼Œä¸é€æ˜é”™è¯¯æ˜¯ç”¨æ¥ç®€åŒ–é”™è¯¯å¤„ç†ï¼Œä»¥åŠä½œä¸ºè°ƒè¯•è¾…åŠ©å·¥å…·ã€‚ä¸€ä¸ªä½¿ç”¨ä¸é€æ˜é”™è¯¯çš„ä¾‹å­ï¼š</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;os&quot;

    &quot;github.com/cockroachdb/errors&quot;
)

func main() &#123;
    if err := a(); err != nil &#123;
        fmt.Printf(&quot;a() failed: %+v&quot;, err)
    &#125;
&#125;

func a() error &#123;
    if err := b(); err != nil &#123;
        return err
    &#125;
    return nil
&#125;

func b() error &#123;
    if _, err := os.Open(&quot;config.json&quot;); err != nil &#123;
        return errors.Wrap(err, &quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥&quot;)
    &#125;
    return nil
&#125;
</code></pre>
<p>è¿è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¼šè¾“å‡ºï¼š</p>
<pre><code class="shell">a() failed: open config.json: no such file or directory
æ‰“å¼€æ–‡ä»¶å¤±è´¥
main.b
        /Users/boren/projects/goerr/main.go:25 # åœ¨ IDE çš„ç»ˆç«¯çª—å£ç‚¹å‡»è¿™ä¸€è¡Œï¼Œä¼šè·³è½¬åˆ°æŠ¥é”™çš„ä»£ç å¤„
main.a
        /Users/boren/projects/goerr/main.go:17
main.main
        /Users/boren/projects/goerr/main.go:11
runtime.main
        /Users/boren/.go/src/runtime/proc.go:250
runtime.goexit
        /Users/boren/.go/src/runtime/asm_arm64.s:1263
Process finished with the exit code 0</code></pre>
<p>ä½¿ç”¨ <code>Wrap</code> åï¼Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯æ›´åŠ è¯¦ç»†äº†ï¼Œéå¸¸æ–¹ä¾¿è°ƒè¯•ã€‚</p>
<p>ä½¿ç”¨ <code>fmt.Printf(&quot;a() failed: %+v&quot;, err)</code> æ‰“å°é”™è¯¯ä¿¡æ¯åªé€‚åˆè°ƒè¯•é˜¶æ®µä½¿ç”¨ï¼Œåœ¨æµ‹è¯•æˆ–è€…ç”Ÿäº§ç¯å¢ƒé˜¶æ®µä½¿ç”¨åˆ™ä¸å¤ªåˆé€‚ï¼Œå› ä¸ºè¿™ä¸ªä¿¡æ¯ä»¥ JSON æ ¼å¼æ‰“å°ä¸å‹å¥½ï¼Œè¿™æ—¶å€™ä½¿ç”¨ <code>fmt.Printf(&quot;a() failed: %v&quot;, err)</code> æ‰“å°æ›´åˆé€‚ã€‚ä¸¤è€…çš„åŒºåˆ«å°±æ˜¯ <code>%+v</code> å’Œ <code>%v</code> çš„åŒºåˆ«ï¼Œå‰è€…ä¼šæ‰“å°å‡º err çš„ stack traceï¼Œåè€…åªä¼šæ‰“å° <code>err.Error()</code> çš„å€¼ã€‚</p>
<h2 id="å¦‚ä½•é€‰æ‹©é”™è¯¯å¤„ç†ç­–ç•¥"><a href="#å¦‚ä½•é€‰æ‹©é”™è¯¯å¤„ç†ç­–ç•¥" class="headerlink" title="å¦‚ä½•é€‰æ‹©é”™è¯¯å¤„ç†ç­–ç•¥"></a>å¦‚ä½•é€‰æ‹©é”™è¯¯å¤„ç†ç­–ç•¥</h2><p>ç°åœ¨æˆ‘ä»¬äº†è§£äº†ä¸Šè¿°ä¸‰ç§é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­æˆ‘ä»¬è¯¥ç”¨å“ªä¸€ç§å‘¢ï¼Ÿä¸é€æ˜é”™è¯¯è¢«æè¿°æˆæ˜¯æœ€çµæ´»çš„ï¼Œæˆ‘ä»¬å¹²è„†å°±ç”¨è¿™ä¸€ç§å§ï¼ä½†æ˜¯å¾ˆé—æ†¾ï¼Œä¸é€æ˜é”™è¯¯å¹¶éé“¶å¼¹ï¼Œå®ƒæ— æ³•ä¸€å¹¶è§£å†³ Go é”™è¯¯å¤„ç†çš„å„ç§ç—›ç‚¹ã€‚ç°å®ä¸–ç•Œä¸­çš„ Go é¡¹ç›®ï¼Œå¯èƒ½æ— æ³•å®Œå…¨é¿å…å“¨å…µé”™è¯¯å’Œé”™è¯¯ç±»å‹ï¼Œè€Œæ˜¯éœ€è¦ç»“åˆä¸‰ç§é”™è¯¯å¤„ç†ç­–ç•¥ï¼</p>
<ul>
<li>å¯¹äº API ç±»å‹çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›è¯¦ç»†çš„ã€åˆ†ç±»çš„é”™è¯¯ç»™è°ƒç”¨æ–¹ï¼Œå› æ­¤è¿™ç§ç±»å‹çš„é¡¹ç›®çš„é”™è¯¯å¤„ç†å¾ˆæœ‰æŒ‘æˆ˜ï¼Œå¾ˆéš¾é¿å…å“¨å…µé”™è¯¯å’Œé”™è¯¯ç±»å‹ã€‚æ¯”å¦‚ï¼šä½¿ç”¨ ID æŸ¥è¯¢èµ„æºæ—¶ï¼Œæ€»æ˜¯è¦åœ¨å½“ <code>err == sql.ErrNoRows</code> æˆç«‹æ—¶è¿”å› <code>HTTP 404</code> ç»™å®¢æˆ·ç«¯ï¼Œæ­¤å¤„æ— æ³•é¿å…ä½¿ç”¨å“¨å…µé”™è¯¯ï¼›</li>
<li>å¯¹äº API ç±»å‹çš„é¡¹ç›®ï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®šäº†è¿”å›çš„å…·ä½“çš„ HTTP status codeï¼Œä½†è¿˜éœ€è¦è¿”å›æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨é”™è¯¯ç±»å‹ï¼›</li>
<li>å¯¹äºéæ¥å£ç±»çš„é¡¹ç›®ï¼Œæ¯”å¦‚åå°ç±»ã€å®šæ—¶ä»»åŠ¡ç±»é¡¹ç›®ï¼Œæˆ‘ä»¬å¯èƒ½æ˜¯é‡åˆ°é”™è¯¯å°±æ‰“å°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ç»ˆæ­¢æ‰§è¡Œæµç¨‹ï¼Œå¹¶ä¸éœ€è¦åŒºåˆ†åˆ°è¯¦ç»†çš„é”™è¯¯ç±»å‹ï¼Œå› æ­¤å¯èƒ½ä¼šæ›´å¤šåœ°ç”¨åˆ°ä¸é€æ˜é”™è¯¯ï¼›</li>
</ul>
<p>æˆ‘ä»¬è¯´çš„è¦å°½é‡å‡å°‘åŒ…ä¸åŒ…ä¹‹é—´å­˜åœ¨çš„è€¦åˆå…³ç³»ï¼Œå°½é‡å‡å°‘åŒ…ä¸åŒ…ä¹‹é—´çš„æºä»£ç ä¾èµ–å…³ç³»ï¼ŒæŒ‡çš„æ˜¯æ˜¯è¦é¿å…éç›´æ¥è°ƒç”¨çš„åŒ…ä¹‹é—´çš„è€¦åˆå’Œæºä»£ç ä¾èµ–å…³ç³»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å­˜åœ¨è¿™æ ·ä¸€ä¸ªè°ƒç”¨é“¾æ¡ï¼š<code>a.A() -&gt; b.B() -&gt; c.C()</code>ï¼Œæˆ‘ä»¬è¦åšåˆ° <code>a</code> åŒ…é¿å…å¯¼å…¥ <code>c</code>åŒ…ã€‚<code>a</code> åŒ…å¤©ç„¶è€¦åˆå’Œä¾èµ– <code>b</code> åŒ…ï¼Œå› æ­¤ <code>b</code> åŒ…åœ¨å¿…è¦æƒ…å†µä¸‹æ˜¯å¯ä»¥è¿”å›å“¨å…µé”™è¯¯å’Œé”™è¯¯ç±»å‹ç»™ <code>a</code> åŒ…çš„ã€‚</p>
<p>å¦å¤–æˆ‘ä»¬éœ€è¦æ˜ç™½ï¼Œé”™è¯¯å¤„ç†ç­–ç•¥ä¸æ˜¯æ’ä»–çš„ï¼Œä¸æ˜¯éé»‘å³ç™½çš„ï¼Œä¸æ˜¯é€‰æ‹©äº†ä¸€ç§å°±ä¸èƒ½ç”¨å¦ä¸€ç§ã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª error ä¸Šç»“åˆäº†å¤šç§ç­–ç•¥ï¼Œæ¯”å¦‚ä¸€ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p>
<p>ä¸é€æ˜é”™è¯¯ç»“åˆå“¨å…µé”™è¯¯ï¼š</p>
<pre><code class="go">// projtmpl/internal/repository/user/user.go
package user

import (
    &quot;github.com/cockroachdb/errors&quot;
)

type Repository struct &#123;
    DB *sql.DB
&#125;

func (r *Repository) SelectOne(ctx context.Context, id int64) (*model.User, error) &#123;
    user, err := model.FindUser(ctx, r.DB, id)
    return user, errors.Wrap(err, &quot;select one user failed&quot;) // id å¯¹åº”çš„ user ä¸å­˜åœ¨æ—¶ï¼Œerr å€¼ç­‰äº sql.ErrNoRowsï¼Œæ­¤æ—¶ err è¢« Wrap æˆä¸€ä¸ªä¸é€æ˜é”™è¯¯
&#125;</code></pre>
<p>ä¸é€æ˜é”™è¯¯ç»“åˆé”™è¯¯ç±»å‹ï¼š</p>
<pre><code class="go">// iCareFiles é¡¹ç›®çš„ä¸€ä¸ªé”™è¯¯å¤„ç†æ¡ˆä¾‹ï¼Œè°ƒç”¨å…³ç³»æ—¶ï¼šcontorller/drive åŒ… -&gt; service/drive åŒ… -&gt; driver åŒ…

// ===== åˆ†å‰²çº¿ =====
// contorller/drive åŒ…
// NewFolder å®ç°æ–°å»ºæ–‡ä»¶å¤¹åŠŸèƒ½
func (h *Handler) NewFolder(c *gin.Context) &#123;
    // è°ƒç”¨ service å±‚ï¼Œå¼€å§‹æ–°å»ºæ–‡ä»¶
    output, err := h.Services.Drive.NewFolder(&amp;drive.NewFolderInput&#123;
        Drive:            d,
        Name:             req.Name,
        ParentFolderID:   req.ParentFolderID,
        ParentFolderPath: req.ParentFolderPath,
    &#125;)
    if err != nil &#123;
    if authErr, ok := errors.Cause(err).(*drive.ErrUnauthorizedAccess); ok &#123;
      // è¯†åˆ«å‡ºäº†å…·ä½“çš„é”™è¯¯ç±»å‹ï¼Œè¿”å›å‡†ç¡®çš„ HTTP çŠ¶æ€ç 
            response.UnauthorizedDriveAccess(c, err)
            return
        &#125;
    ...
    &#125;
    ...
&#125;

// ===== åˆ†å‰²çº¿ =====
// service/drive åŒ…
// NewFolder æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ª UnauthorizedDriveAccess é”™è¯¯
type ErrUnauthorizedAccess struct &#123;
  // DriveType æ˜¯äº‘ç›˜ç±»å‹ï¼Œ1 ä»£è¡¨ Google Driveï¼Œ2 ä»£è¡¨ Google Photos
    DriveType  int
  // DriveName äº‘ç›˜åå­—
  DriveName int
  // DriveEmail è¡¨ç¤ºäº‘ç›˜ç”¨æˆ·çš„ email
    DriveEmail string
&#125;

// å¿…é¡»å®ç° Error() æ–¹æ³•ï¼Œä»¥è¡¨æ˜ *ErrUnauthorizedAccess å®ç°äº† error æ¥å£
func (e *ErrUnauthorizedAccess) Error() string &#123;
  if len(t.DriveEmail) == 0 &#123;
        return fmt.Sprintf(
            &quot;Your %s authorization to iCareFiles has expired&quot;,
            DriveName,
        )
    &#125;
    return fmt.Sprintf(
        &quot;Your %s(%s) authorization to iCareFiles has expired&quot;,
        DriveName,
        t.DriveEmail,
    )
&#125;

// NewFolder æ˜¯ service å±‚çš„æ–°å»ºæ–‡ä»¶ï¼Œè´Ÿè´£è°ƒç”¨ç½‘ç›˜è®¿é—®å±‚çš„æ–°å»ºæ–‡ä»¶å¤¹æ¥å£
func (s *Service) NewFolder(input *NewFolderInput) (*NewFolderOutput, error) &#123;
    ...
    out, err := drive.NewFolder(&amp;params)
    if err != nil &#123;
    if authErr, ok := errors.Cause(err).(*driver.UnauthorizedDriveAccess); ok &#123;
      // åšç±»å‹æ–­è¨€ï¼Œå¦‚æœæ˜¯ *driver.UnauthorizedDriveAccessï¼Œé‚£ä¹ˆè¿”å› ErrUnauthorizedAccess
      return &amp;ErrUnauthorizedAccess&#123;
        DriveType: authErr.DriveType, 
        DriveName: modext.DriveNameFromType(t.DriveType), 
        DriveEmail: authErr.DriveEmail,
      &#125;
    &#125;
        return nil, errors.Wrapf(err, &quot;new folder failed&quot;) // NewFolder è¿”å›é”™è¯¯ç±»å‹ UnauthorizedDriveAccess æ—¶ï¼Œåœ¨è¿™é‡Œè¢« Wrap æˆä¸€ä¸ªä¸é€æ˜é”™è¯¯
    &#125;
    ...
&#125;

// ===== åˆ†å‰²çº¿ =====
// driver åŒ…
// ä½äºæ–‡ä»¶ï¼špkg/driver/dropbox.go
// UnauthorizedDriveAccess æ˜¯ä¸€ä¸ªé”™è¯¯ç±»å‹ï¼Œå½“é‡åˆ°è¿™ç§é”™è¯¯æ—¶ï¼Œå‰ç«¯é¡µé¢éœ€è¦å±•ç¤ºç”¨æˆ· email æ˜¯ xxx çš„ yyy ç½‘ç›˜çš„æˆæƒè®¿é—®è¿‡æœŸäº†ï¼Œ
// å¼•å¯¼ç”¨æˆ·å†æ¬¡å®Œæˆæˆæƒæµç¨‹
type UnauthorizedDriveAccess struct &#123;
  // DriveType æ˜¯äº‘ç›˜ç±»å‹ï¼Œ1 ä»£è¡¨ Google Driveï¼Œ2 ä»£è¡¨ Google Photos
    DriveType  int
  // DriveEmail è¡¨ç¤ºäº‘ç›˜ç”¨æˆ·çš„ email
    DriveEmail string
&#125;

// å¿…é¡»å®ç° Error() æ–¹æ³•ï¼Œä»¥è¡¨æ˜ *UnauthorizedDriveAccess å®ç°äº† error æ¥å£
func (t *UnauthorizedDriveAccess) Error() string &#123;
  return fmt.Sprintf(&quot;drive type: t.DriveType, drive email: t.DriveEmail&quot;)
&#125;

// NewFolder æ˜¯ç½‘ç›˜è®¿é—®å±‚çš„æ–°å»ºæ–‡ä»¶å¤¹ï¼Œè´Ÿè´£å…·ä½“è°ƒç”¨ Dropbox çš„æ¥å£æ–°å»ºæ–‡ä»¶å¤¹
func (d *Dropbox) NewFolder(input *NewFolderParameters) (*NewFolderResult, error) &#123;
    ...
    if !resp.IsSuccess() &#123;
        if resp.StatusCode() == http.StatusUnauthorized &#123;
            return nil, &amp;UnauthorizedDriveAccess&#123;
        DriveType: modext.Dropbox, 
        DriveEmail: input.Drive.AccountEmail.String,
      &#125;
        &#125;
        return nil, errors.Newf(&quot;new Dropbox folder failed: code=%d, msg=%s&quot;, resp.StatusCode(), resp.String())
    &#125;
  ...
&#125;
</code></pre>
<h2 id="é”™è¯¯å¤„ç†åº“"><a href="#é”™è¯¯å¤„ç†åº“" class="headerlink" title="é”™è¯¯å¤„ç†åº“"></a>é”™è¯¯å¤„ç†åº“</h2><p>ç”±å‰ä¸€èŠ‚å†…å®¹å¯ä»¥çœ‹åˆ°ï¼Œä¸é€æ˜é”™è¯¯çš„å¤„ç†ä¾èµ–é”™è¯¯å¤„ç†å·¥å…·åº“ã€‚Go ç”Ÿæ€é‡Œæœ€å…ˆå¼€å§‹æµè¡Œçš„åº“æ˜¯ <a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a> ï¼Œåæ¥ Go å®˜æ–¹åœ¨ Go 1.13 æ ‡å‡†åº“é‡Œæ·»åŠ äº† errors åŒ… ä»¥åŠ <code>fmt.Errorf()</code> ï¼Œè¿™ä¸ªç»„åˆåŸºæœ¬ä¸Šå¯ä»¥å®Œæˆè·Ÿ <a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a> åŒæ ·çš„åŠŸèƒ½ï¼Œé™¤äº† <code>fmt.Errorf()</code> ä¸èƒ½åƒ  <a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a>  çš„ Wrap ä¸€æ ·ä¿ç•™ stack trace å¤–ã€‚</p>
<p>å¯èƒ½æ˜¯ç”±äº errors åŒ… ä»¥åŠ <code>fmt.Errorf()</code> ç»„åˆæ— æ³•æ»¡è¶³éœ€æ±‚ï¼ŒGo ç”Ÿæ€é‡Œä»ç„¶æœ‰å¾ˆå¤šå¼€å‘è€…åœ¨å¼€å‘å’Œç»´æŠ¤é”™è¯¯å¤„ç†åº“ï¼Œå¸¸è§çš„é€‰æ‹©æœ‰ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/pkg/errors">pkg/errors</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/golang/xerrors">xerrors</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/joomcode/errorx">joomcode/errorx</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cockroachdb/errors">cockroachdb/errors</a></li>
<li>â€¦</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/cockroachdb/errors">cockroachdb/errors</a> çš„åŠŸèƒ½å’Œ star æ•°æœ€å¤šï¼Œå› æ­¤æ›´æ¨èä½¿ç”¨è¿™ä¸ªã€‚cockroachdb/errors å¸¸ç”¨çš„å‡½æ•°æœ‰ï¼š</p>
<ul>
<li><p><code>New(msg string) error</code> æ„é€ ä¸€ä¸ªæ–°çš„ err å¹¶ä¿ç•™ stack traceï¼›</p>
</li>
<li><p><code>Newf(format string, args ...interface&#123;&#125;) error</code> åŒä¸Šï¼Œä½†æ˜¯ä½¿ç”¨æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ï¼›</p>
</li>
<li><p><code>Wrap(err error, msg string) error</code> ä½¿ç”¨ err å’Œ msg åŒ…è£…å‡ºä¸€ä¸ªæ–°çš„ error å¹¶ä¿ç•™ stack traceï¼›</p>
</li>
<li><p><code>Cause(err error) error</code> è·å–æ ¹å› é”™è¯¯ï¼Œå³è·å– <code>Wrap(err error, msg string) error</code> ä¼ è¿›æ¥çš„å‚æ•° errï¼›</p>
</li>
<li><p><code>WithMessage(err error, message string) error</code> ä½¿ç”¨ err å’Œ msg åŒ…è£…å‡ºä¸€ä¸ªæ–°çš„ error ä½†<strong>ä¸ä¼šä¿ç•™</strong> stack traceï¼›</p>
</li>
<li><p><code>WithMessagef(err error, format string, args ...interface&#123;&#125;) error</code> åŒä¸Šï¼›</p>
</li>
<li><p><code>WithStack(err error) error</code> ä½¿ç”¨ err å’Œ stack trace åŒ…è£…å‡ºä¸€ä¸ªæ–°çš„ error </p>
</li>
<li><p><code>Is(err, reference error) bool</code> æ£€æŸ¥ err åŒ…è£…ç€çš„æ‰€æœ‰çš„ errorï¼Œå¦‚æœ‰ä»»ä¸€ä¸ª error çš„ç±»å‹è·Ÿ <code>reference</code> ä¸€æ ·ï¼Œåˆ™è¿”å› trueï¼›</p>
</li>
<li><p><code>IsAny(err error, references ...error) bool</code> åŒä¸Šï¼ŒåŒºåˆ«æ˜¯ <code>...error</code> è¡¨ç¤ºå¯ä»¥ä¼ å¤šä¸ª <code>reference</code>ï¼›</p>
</li>
<li><p><code>HasInterface(err error, referenceInterface interface&#123;&#125;) bool</code> æ£€æŸ¥ err æ˜¯å¦åŒ…å«æœ‰å®ç°äº† <code>referenceInterface</code> æ¥å£çš„ errorï¼Œæœ‰çš„è¯è¿”å› trueã€‚<code>referenceInterface</code> å¿…é¡»æ˜¯æŒ‡å‘æ¥å£çš„æŒ‡é’ˆï¼›</p>
</li>
<li><p><code>WithSecondaryError(err error, additionalErr error) error</code> ä½¿ç”¨æ¬¡è¦çš„é”™è¯¯ <code>additionalErr</code> å¢å¼ºä¸»é”™è¯¯ <code>err</code> ï¼Œå¹¶ä¸” <code>additionalErr</code> åœ¨ <code>Cause</code> ç­‰å‡½æ•°ä¸­ä¸èµ·ä½œç”¨ï¼›</p>
</li>
</ul>
<h2 id="é”™è¯¯å¤„ç†å®è·µ"><a href="#é”™è¯¯å¤„ç†å®è·µ" class="headerlink" title="é”™è¯¯å¤„ç†å®è·µ"></a>é”™è¯¯å¤„ç†å®è·µ</h2><p>åœ¨äº†è§£äº†é”™è¯¯å¤„ç†åº“åï¼Œåœ¨å¼€å‘ä¸­æˆ‘ä»¬å¯ä»¥ä»¥ <a target="_blank" rel="noopener" href="https://dave.cheney.net/">Dave Cheney</a> çš„æ€»ç»“ä¸ºæŒ‡å—ï¼š</p>
<ol>
<li><p>ä½¿ç”¨ <code>errors.New</code> æˆ–è€… <code>errors.Newf</code> ç”Ÿæˆä¸€ä¸ªæ–°çš„é”™è¯¯å¹¶è¿”å›ï¼š</p>
<pre><code class="go">func parseArgs(args []string) error &#123;
    if len(args) &lt; 3 &#123;
        return errors.Newf(&quot;args length is %d, expect %d&quot;, len(args), 3)
    &#125;
&#125;</code></pre>
</li>
<li><p>ä¸æ ‡å‡†åº“æˆ–è€…ç¬¬ä¸‰æ–¹çš„åº“ï¼ˆGitHub ä¸Šçš„ ï¼‰è¿›è¡Œåä½œçš„æ—¶å€™ï¼Œè€ƒè™‘ä½¿ç”¨ <code>errors.Wrap</code> æˆ–è€… <code>errors.Wrapf</code> åŒ…è£…é”™è¯¯ä»¥ä¿å­˜ stack traceï¼š</p>
<pre><code class="go">f, err := os.Open(path)
if err != nil &#123;
    return errors.Wrapf(err, &quot;failed to open %q&quot;, path)
&#125;</code></pre>
</li>
<li><p>å¦‚æœä½ ä»å¦ä¸€ä¸ªå‡½æ•°æ”¶åˆ°é”™è¯¯ï¼Œé€šå¸¸åªéœ€è¿”å›å®ƒå°±è¶³å¤Ÿäº†ã€‚å› ä¸ºæŒ‰ç…§ä¸Šé¢ç¬¬ 1 ç‚¹ï¼Œä½ å¾—åˆ°çš„é”™è¯¯å·²ç»æ˜¯ä¸€ä¸ªå·²ç»åŠ äº†ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œ stack trace çš„é”™è¯¯ï¼Œæ‰€ä»¥æ— éœ€å†é‡å¤æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</p>
<pre><code class="go">err := parseArgs()
if err != nil &#123;
    return err
&#125;</code></pre>
</li>
<li><p>å§‹ç»ˆå°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ï¼Œè€Œä¸æ˜¯åœ¨æ¯å¤„éƒ½æ‰“å°æ—¥å¿—ï¼›</p>
</li>
<li><p>åœ¨ç¨‹åºçš„é¡¶å±‚æˆ–å·¥ä½œ goroutine çš„é¡¶å±‚ï¼Œä½¿ç”¨ <code>%+v</code> ä»¥è¶³å¤Ÿè¯¦ç»†çš„æ–¹å¼æ‰“å°é”™è¯¯ï¼š</p>
<pre><code class="go">func main() &#123;
    err := app.Run()
    if err != nil &#123;
        log.Print(err)
        os.Exit(1)
    &#125;
&#125;</code></pre>
</li>
<li><p>å¦‚æœä½ æƒ³ä»æ‰“å°ä¸­æ’é™¤æŸäº›ç±»åˆ«çš„é”™è¯¯ï¼Œè¯·åœ¨æ‰“å°é”™è¯¯ä¹‹å‰ä½¿ç”¨ <code>errors.Cause</code> è§£å¼€é”™è¯¯ã€‚</p>
</li>
</ol>
<h2 id="é”™è¯¯å¤„ç†æŠ€å·§"><a href="#é”™è¯¯å¤„ç†æŠ€å·§" class="headerlink" title="é”™è¯¯å¤„ç†æŠ€å·§"></a>é”™è¯¯å¤„ç†æŠ€å·§</h2><h3 id="Fail-fast-å°½æ—©å¤„ç†é”™è¯¯"><a href="#Fail-fast-å°½æ—©å¤„ç†é”™è¯¯" class="headerlink" title="Fail-fast: å°½æ—©å¤„ç†é”™è¯¯"></a>Fail-fast: å°½æ—©å¤„ç†é”™è¯¯</h3><p>Go ä»£ç é‡Œ <code>if err != nil &#123;&#125;</code> ä¼šéå¸¸å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨æ¯æ¬¡é‡åˆ°é”™è¯¯æ—¶å°±ç«‹é©¬å¤„ç†é”™è¯¯ï¼Œé¿å…æœ‰è¿‡å¤šçš„åµŒå¥—ä»£ç å—ã€‚ç¤ºä¾‹ï¼š</p>
<p>è¿™æ ·åšï¼š</p>
<pre><code class="go">f, err := func1()
if err != nil &#123;
    // å¤„ç†é”™è¯¯
&#125;

// æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæµç¨‹
err = func2()
if err != nil &#123;
    // å¤„ç†é”™è¯¯
&#125;

// æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæµç¨‹
err = func3()
if err != nil &#123;
    // å¤„ç†é”™è¯¯
&#125;

return nil</code></pre>
<p>ä¸è¦è¿™æ ·åšï¼š</p>
<pre><code class="go">f, err := os.func1()
if err == nil &#123;
    // æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæµç¨‹
    err = func2()
    if err == nil &#123;
        // æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæµç¨‹
        err = func3()
        if err == nil &#123;
            // æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæµç¨‹
            return nil
        &#125;
        // æœ‰é”™è¯¯ï¼Œå¤„ç†é”™è¯¯
    &#125;
        // æœ‰é”™è¯¯ï¼Œå¤„ç†é”™è¯¯
&#125;</code></pre>
<p>è¿™ä¸¤ç§å†™æ³•ä¸­ç¬¬ 1 ç§æ›´åˆç†ï¼Œä¸”å¯è¯»æ€§æ›´å¥½ï¼›ç¬¬ 2 ç§å†™æ³•æ˜¯ç³Ÿç³•çš„ï¼Œä»£ç æœ‰å¾ˆå¤šç¼©è¿›å—ï¼Œå¯è¯»æ€§å¾ˆå·®ã€‚äººè„‘å¤©ç”Ÿä¸é€‚åˆå»ç†è§£è¿™ç§å±‚å±‚åµŒå¥—çš„ä¸œè¥¿ï¼ˆæƒ³æƒ³é€’å½’å‡½æ•°ï¼Œä½ èƒ½å¾€è„‘è¢‹é‡Œå‹è¿›æ‰€æœ‰çš„é€’å½’è°ƒç”¨å—ğŸ˜‚ï¼‰ã€‚</p>
<h3 id="é€šè¿‡å‡å°‘é”™è¯¯å‡ºç°çš„æ¬¡æ•°çš„æ–¹å¼å»å‡å°‘é”™è¯¯å¤„ç†çš„æ¬¡æ•°"><a href="#é€šè¿‡å‡å°‘é”™è¯¯å‡ºç°çš„æ¬¡æ•°çš„æ–¹å¼å»å‡å°‘é”™è¯¯å¤„ç†çš„æ¬¡æ•°" class="headerlink" title="é€šè¿‡å‡å°‘é”™è¯¯å‡ºç°çš„æ¬¡æ•°çš„æ–¹å¼å»å‡å°‘é”™è¯¯å¤„ç†çš„æ¬¡æ•°"></a>é€šè¿‡å‡å°‘é”™è¯¯å‡ºç°çš„æ¬¡æ•°çš„æ–¹å¼å»å‡å°‘é”™è¯¯å¤„ç†çš„æ¬¡æ•°</h3><p>è¦è¿™æ ·å­ï¼š</p>
<pre><code class="go">func AuthenticateRequest(r *Request) error &#123;
    return authenticate(r.User)
&#125;</code></pre>
<p>ä¸è¦è¿™æ ·å­ï¼š</p>
<pre><code class="go">func AuthenticateRequest(r *Request) error &#123;
    err := authenticate(r.User)
    if err != nil &#123;
        return err
    &#125;
    return nil
&#125;</code></pre>
<p>æ¥çœ‹ä¸€ä¸ª Rob Pike çš„æ›´åŠ å·§å¦™çš„ä¾‹å­ï¼š</p>
<pre><code class="go">_, err = fd.Write(p0[a:b])
if err != nil &#123;
    return err
&#125;
_, err = fd.Write(p1[c:d])
if err != nil &#123;
    return err
&#125;
_, err = fd.Write(p2[e:f])
if err != nil &#123;
    return err
&#125;
// and so on</code></pre>
<p>è¿™æ®µä»£ç æœ‰ 3 ä¸ªé”™è¯¯æ˜¯å¦ä¸º nil çš„æ£€æŸ¥ï¼Œè¿™äº›é‡å¤ã€ç¹ççš„ä»£ç è®©ä»£ç å¤±å»äº†ä¼˜é›…ã€‚åº”ç”¨åŒæ ·çš„åŸç†ï¼Œè¿™æ®µä»£ç å¯ä»¥ä¼˜åŒ–ä¸ºï¼š</p>
<pre><code class="go">type errWriter struct &#123;
    w   io.Writer
    err error
&#125;

func (ew *errWriter) write(buf []byte) &#123;
    if ew.err != nil &#123;
        return
    &#125;
    _, ew.err = ew.w.Write(buf)
&#125;

ew := &amp;errWriter&#123;w: fd&#125;
ew.write(p0[a:b])
ew.write(p1[c:d])
ew.write(p2[e:f])
// and so on
if ew.err != nil &#123;
    return ew.err
&#125;</code></pre>
<p>æœ€åå¾—åˆ°çš„ä»£ç æ›´åŠ ç®€æ´ã€ä¼˜é›…ã€‚</p>
<h3 id="æ¯ä¸ªé”™è¯¯åªå¤„ç†ä¸€æ¬¡"><a href="#æ¯ä¸ªé”™è¯¯åªå¤„ç†ä¸€æ¬¡" class="headerlink" title="æ¯ä¸ªé”™è¯¯åªå¤„ç†ä¸€æ¬¡"></a>æ¯ä¸ªé”™è¯¯åªå¤„ç†ä¸€æ¬¡</h3><p><a target="_blank" rel="noopener" href="https://dave.cheney.net/">Dave Cheney</a> ï¼ˆGo é¡¹ç›®å¸¸å¹´æ´»è·ƒçš„è´¡çŒ®è€…ï¼‰åœ¨ <a target="_blank" rel="noopener" href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Donâ€™t just check errors, handle them gracefully</a> ä¸­æåˆ°ï¼Œé”™è¯¯åªåº”è¯¥å¤„ç†ä¸€æ¬¡ï¼Œå¤„ç†é”™è¯¯æ„å‘³ç€æ£€æŸ¥é”™è¯¯å€¼å¹¶åšå‡ºå†³å®šã€‚è¿™å¥è¯çš„æ„æ€æ¯ä¸€æ¬¡æ£€æŸ¥é”™è¯¯ï¼Œæˆ‘ä»¬åªåº”è¯¥åšå‡ºä¸€ä¸ªé€‰æ‹©ã€‚</p>
<p>å¯¹äºä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æœä½ åšå‡ºå°‘äºä¸€æ¬¡çš„é€‰æ‹©ï¼ˆæ²¡æœ‰æ¥æ”¶å‡½æ•°è¿”å›çš„ errorï¼Œæˆ–è€…æ¥æ”¶äº†ä½†ä¸å¤„ç†ï¼‰ï¼Œä½ å°±æ˜¯åœ¨å¿½ç•¥é”™è¯¯ã€‚å°±åƒæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œ<code>w.Write</code> è¿”å›çš„é”™è¯¯æ²¡æœ‰è¢«æ¥æ”¶ï¼š</p>
<pre><code class="go">func Write(w io.Writer, buf []byte) &#123;
        w.Write(buf)
&#125;</code></pre>
<p>å¯¹äºä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æœä½ åšå‡ºå¤šäºä¸€æ¬¡çš„é€‰æ‹©ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼š</p>
<pre><code class="go">func Write(w io.Writer, buf []byte) error &#123;
        _, err := w.Write(buf)
        if err != nil &#123;
                // annotated error goes to log file
                log.Println(&quot;unable to write:&quot;, err)

                // unannotated error returned to caller
                return err
        &#125;
        return nil
&#125;</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>w.Write</code> è¿”å›äº†ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆä»£ç ä¼šæ‰“å°ä¸€æ¡æ—¥å¿—ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªé”™è¯¯è¢«è¿”å›ç»™ <code>Write</code> çš„è°ƒç”¨è€…ï¼Œè€Œ <code>Write</code> çš„è°ƒç”¨è€…ä¹Ÿæœ‰å¯èƒ½ä¼šåšåŒæ ·çš„æ“ä½œï¼šæ‰“å°æ—¥å¿—ï¼Œç„¶åç»§ç»­å‘ä¸Šé€ä¼ ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å¾—åˆ°äº†å¤šä½™çš„ã€é‡å¤çš„æ—¥å¿—æ‰“å°ï¼Œè¿™æ˜¯å¾ˆç³Ÿç³•çš„ï¼Œæ— ç›Šäºæˆ‘ä»¬è·Ÿè¸ªé”™è¯¯ã€‚è€Œä¸”åœ¨è°ƒç”¨é“¾çš„å¼€å§‹å¤„ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯æ²¡æœ‰ä»»ä½•ä¸Šä¸‹æ–‡çš„åŸå§‹é”™è¯¯ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•åˆ¤æ–­é”™è¯¯æ˜¯ä»è°ƒç”¨é“¾ä¸­çš„å“ªä¸€ä¸ªèŠ‚ç‚¹æŠ›å‡ºçš„ã€‚<code>Wrap errors</code> è¿™ä¸ªæ—¶å€™æ´¾ä¸Šäº†ç”¨åœºï¼š</p>
<pre><code class="go">func Write(w io.Write, buf []byte) error &#123;
        _, err := w.Write(buf)
        return errors.Wrap(err, &quot;write failed&quot;)
&#125;</code></pre>
<p>ä½¿ç”¨ errors packageï¼Œç»™é”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œ stack traceï¼Œè¿™æ ·ç¨‹åºå‘˜å’Œæœºå™¨éƒ½èƒ½å¾ˆå¥½åœ°æ£€æŸ¥é”™è¯¯ã€‚</p>
<h3 id="æ–­è¨€é”™è¯¯çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç±»å‹"><a href="#æ–­è¨€é”™è¯¯çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç±»å‹" class="headerlink" title="æ–­è¨€é”™è¯¯çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç±»å‹"></a>æ–­è¨€é”™è¯¯çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç±»å‹</h3><p>åœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œopaque error è¿™ç§éæ­¤å³å½¼çš„é”™è¯¯å¤„ç†æ–¹æ³•æ˜¯ä¸å¤Ÿçš„ã€‚æœ‰ä¸€äº›åœºæ™¯æˆ‘ä»¬æ˜¯éœ€è¦è¯¦ç»†çš„ error ä¿¡æ¯çš„ã€åº•å±‚çš„é”™è¯¯ï¼Œ</p>
<p>ä¾‹å¦‚ï¼Œä¸è¿›ç¨‹å¤–çš„ä¸–ç•Œè¿›è¡Œäº¤äº’ï¼Œéœ€è¦è°ƒç”¨æ–¹è°ƒæŸ¥é”™è¯¯çš„æ€§è´¨ï¼Œä»¥ç¡®å®šæ˜¯å¦éœ€è¦é‡è¯•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ£€æŸ¥é”™è¯¯å®ç°äº†ç‰¹å®šçš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯æ–­è¨€é”™è¯¯æ˜¯ç‰¹å®šçš„ç±»å‹æˆ–å€¼ã€‚è€ƒè™‘è¿™ä¸ªä¾‹å­:</p>
<pre><code class="go">type temporary interface &#123;
    Temporary() bool
&#125;

func IsTemporary(err error) bool &#123;
    te, ok := err.(temporary)
    return ok &amp;&amp; te.Temporary()
&#125;

func main() &#123;
    err := ...
    if IsTemporary(err) &#123; 
        ...
    &#125;
&#125;</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•é”™è¯¯ä¼ é€’ç»™ <code>IsTemporary(err error) bool</code> ä»¥ç¡®å®šæ˜¯å¦å¯ä»¥é‡è¯•è¯¥é”™è¯¯ã€‚</p>
<p>å¦‚æœ err æ²¡æœ‰å®ç° <code>temporary</code> æ¥å£ï¼Œä¹Ÿå°±æ˜¯å®ƒæ²¡æœ‰ <code>Temporary()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆ error ä¸æ˜¯ä¸´æ—¶çš„ã€‚</p>
<p>å¦‚æœé”™è¯¯ç¡®å®å®ç°äº† <code>temporary</code> æ¥å£ï¼Œé‚£ä¹ˆå¦‚æœ  <code>Temporary()</code> è¿”å› trueï¼Œè°ƒç”¨è€…ä¹Ÿè®¸å¯ä»¥é‡è¯•æ“ä½œã€‚</p>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å¯¼å…¥å®šä¹‰é”™è¯¯çš„ç¨‹åºåŒ…ï¼Œæˆ–è€…è¯´å¯ä»¥åœ¨ä¸äº†è§£æœ‰å…³é”™è¯¯åº•å±‚ç±»å‹çš„ä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹å®ç°æ­¤é€»è¾‘ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“ err æ˜¯å¦å®ç°äº†æœ‰ <code>Temporary()</code> æ–¹æ³•çš„æ¥å£å³å¯ã€‚</p>
<h3 id="errors-Wrap-å·æ‡’å°æŠ€å·§"><a href="#errors-Wrap-å·æ‡’å°æŠ€å·§" class="headerlink" title="errors.Wrap å·æ‡’å°æŠ€å·§"></a>errors.Wrap å·æ‡’å°æŠ€å·§</h3><p>ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="go">func (r *Repository) SelectOne(ctx context.Context, id int64) (*model.User, error) &#123;
  if user, err := model.FindUser(ctx, r.DB, id); err != nil &#123;
    return nil, errors.Wrap(err, &quot;select one user failed&quot;)
  &#125; else &#123;
    return user, nil
  &#125;
&#125;</code></pre>
<p>å¯ä»¥ä¼˜åŒ–ä¸ºï¼š</p>
<pre><code class="go">func (r *Repository) SelectOne(ctx context.Context, id int64) (*model.User, error) &#123;
    user, err := model.FindUser(ctx, r.DB, id)
    return user, errors.Wrap(err, &quot;select one user failed&quot;)
&#125;</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªèƒ½è®©ä»£ç æ›´ç®€æ´çš„å°æŠ€å·§ï¼Œä½†ä½¿ç”¨åœºæ™¯æœ‰é™ï¼Œä»…é€‚ç”¨äº <code>user, err := model.FindUser(ctx, r.DB, id)</code> è¿™è¡Œä»£ç åé¢è·Ÿç€æ•´ä¸ªå‡½æ•°çš„æœ€åä¸€ä¸ª <code>return</code> è¯­å¥è¿™ä¸ªåœºæ™¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¸ªåœºæ™¯å¯ä»¥è¿™æ ·å†™å‘¢ï¼ŸæŸ¥çœ‹ <code>errors.Wrap(err error, message string)</code> çš„æºç å°±æ˜ç™½äº†ï¼š</p>
<pre><code class="go">// Wrap returns an error annotating err with a stack trace
// at the point Wrap is called, and the supplied message.
// If err is nil, Wrap returns nil.
func Wrap(err error, message string) error &#123;
    if err == nil &#123;
        return nil
    &#125;
    err = &amp;withMessage&#123;
        cause: err,
        msg:   message,
    &#125;
    return &amp;withStack&#123;
        err,
        callers(),
    &#125;
&#125;</code></pre>
<p>å½“ <code>err == nil</code> æˆç«‹æ—¶ï¼Œ<code>Wrap</code> ä¼šç›´æ¥è¿”å› nilï¼Œæ­¤æ—¶ <code>message</code> å‚æ•°æ˜¯ç”¨ä¸åˆ°çš„ï¼›è€Œå½“ <code>err == nil</code> ä¸æˆç«‹æ—¶ï¼Œ<code>Wrap</code> å°†ä½¿ç”¨ <code>err</code> å’Œ <code>message</code> åŒ…è£…æ„é€ ä¸€ä¸ªæ–°çš„ errorã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.golang.org/errors-are-values">Errors are values</a></li>
<li><a target="_blank" rel="noopener" href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Donâ€™t just check errors, handle them gracefully</a></li>
<li><a target="_blank" rel="noopener" href="https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package">Stack traces and the errors package</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.golang.org/error-handling-and-go">Error handling and Go</a></li>
</ul>
</div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '');</script></html>